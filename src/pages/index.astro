---
import BaseLayout from '@/layouts/BaseLayout.astro'
import Card from '@/components/Card.astro'
import type { CollectionEntry } from 'astro:content'
import { getCollection } from 'astro:content'

const commands = await getCollection('commands')
  .then(list => list.sort((a,b)=> a.slug.localeCompare(b.slug)))
const allTags = Array.from(new Set(commands.flatMap((c)=> (c.data as any).tags ?? []))).sort()
---
<BaseLayout title="Linux Cheatsheet">
  <section class="text-center space-y-6">
    <h1 class="text-3xl md:text-5xl font-bold tracking-tight">哪条命令？</h1>
    <p class="text-fg-muted">搜索或从下方选择一个常用命令</p>
    <form action="/" method="GET" role="search" class="mx-auto max-w-xl flex flex-col sm:flex-row gap-2" autocomplete="off">
      <input name="q" placeholder="输入命令，如 grep、sed" class="flex-1 glass rounded-xl px-4 py-3 outline-none focus:ring-2 ring-black/20 dark:ring-white/25 interactive" />
      <div class="relative shrink-0">
        <button id="tag-filter-btn" type="button" class="glass rounded-xl px-3 py-3 text-sm text-fg outline-none border border-white/10 interactive flex items-center gap-1 min-w-[8.5rem] justify-between" aria-haspopup="menu" aria-expanded="false">
          <span id="tag-filter-label">全部标签</span>
          <svg width="16" height="16" viewBox="0 0 24 24" class="opacity-70"><polyline points="6 9 12 15 18 9" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <div id="tag-menu" class="hidden absolute left-0 z-20 mt-1 min-w-[8.5rem] rounded-xl border border-white/10 glass shadow-elevated py-1" role="menu" aria-labelledby="tag-filter-btn">
          <button class="menu-item w-full text-left px-3 py-2 text-sm hover:bg-white/5" data-tag="" role="menuitemradio" aria-checked="true">全部标签</button>
          {allTags.map((t) => (
            <button class="menu-item w-full text-left px-3 py-2 text-sm hover:bg-white/5" data-tag={t} role="menuitemradio" aria-checked="false">{t}</button>
          ))}
        </div>
      </div>
    </form>
  </section>

  <section id="cards" class="mt-10 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
    {commands.map((c)=> (
      <Card title={c.data.title} description={c.data.description} href={`/commands/${c.slug}`} transitionName={`card-${c.slug}`} tags={(c.data as any).tags} />
    ))}
  </section>
</BaseLayout>
